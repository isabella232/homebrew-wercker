box: debian
build:
    steps:
      - install-packages:
            packages: openssh-client git
      - script:
          name: show version and sha256
          code: |
            echo $VERSION
            echo $SHA256
      - script:
          name: build formula template
          code: |
            mkdir -p Formula
            sh builder.sh > Formula/wercker-cli.rb
            ls -la
            cat Formula/wercker-cli.rb
      - script:
          name: set git config
          code: |
            git config --global user.email "walter@wercker.com"
            git config --global user.name "wercker build"
            git config --list
            git remote -v
            git config --global push.default simple
            #git remote set-url origin https://github.com/wercker/homebrew-wercker.git
            git remote -v
            git config --list
            cat .git/config
            #TODO add ssh key or finger print thing?
      - add-to-known_hosts:
            hostname: github.com
            fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
            type: rsa
      - add-ssh-key:
            keyname: GITHUB
      - script:
          name: git steps
          code: |
            git add .
            git commit -m "Release $VERSION"
            git push -f origin HEAD:master

